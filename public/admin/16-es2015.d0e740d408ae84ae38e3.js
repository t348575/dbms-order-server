(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{WKwQ:function(t,e,n){"use strict";n.r(e),n.d(e,"ShippingPageModule",(function(){return j}));var i=n("ofXK"),o=n("3Pt+"),s=n("TEn/"),a=n("tyNb"),b=n("mrSG"),c=n("lDzL"),r=n("Ahj+"),l=n("he5r"),d=n("2g2N"),u=n("fXoL"),h=n("XjXr");function g(t,e){1&t&&(u.Ob(0,"ion-title"),u.sc(1," View / Add states "),u.Nb())}function p(t,e){if(1&t){const t=u.Pb();u.Ob(0,"ion-title"),u.Ob(1,"ion-button",4),u.Wb("click",(function(){u.jc(t);const e=u.Yb();return e.add=!e.add})),u.Kb(2,"ion-icon",5),u.Nb(),u.sc(3," View / Add states "),u.Nb()}}function m(t,e){if(1&t){const t=u.Pb();u.Ob(0,"ion-grid"),u.Ob(1,"ion-row"),u.Ob(2,"ion-col",9),u.sc(3),u.Nb(),u.Ob(4,"ion-col",10),u.Ob(5,"ion-button",11),u.Wb("click",(function(){u.jc(t);const n=e.index;return u.Yb(2).removeStatus(n)})),u.Kb(6,"ion-icon",12),u.Nb(),u.Nb(),u.Nb(),u.Nb()}if(2&t){const t=e.$implicit,n=u.Yb(2);u.xb(3),u.vc(" ",t.value," at ",n.getDate(t.time)," ")}}function f(t,e){if(1&t){const t=u.Pb();u.Ob(0,"ion-content"),u.Ob(1,"ion-list"),u.qc(2,m,7,2,"ion-grid",6),u.Nb(),u.Ob(3,"ion-button",7),u.Wb("click",(function(){u.jc(t);const e=u.Yb();return e.add=!e.add})),u.sc(4," Add status "),u.Kb(5,"ion-icon",8),u.Nb(),u.Nb()}if(2&t){const t=u.Yb();u.xb(2),u.dc("ngForOf",t.states)}}function O(t,e){if(1&t){const t=u.Pb();u.Ob(0,"ion-content"),u.Ob(1,"ion-grid"),u.Ob(2,"ion-row"),u.Ob(3,"ion-col",13),u.Ob(4,"ion-item"),u.Ob(5,"ion-label",14),u.sc(6,"Status text"),u.Nb(),u.Ob(7,"ion-input",15),u.Wb("ngModelChange",(function(e){return u.jc(t),u.Yb().statusText=e})),u.Nb(),u.Nb(),u.Ob(8,"ion-item"),u.Ob(9,"ion-label"),u.sc(10,"Update order"),u.Nb(),u.Ob(11,"ion-toggle",16),u.Wb("ngModelChange",(function(e){return u.jc(t),u.Yb().updateOrder=e}))("ionChange",(function(){return u.jc(t),u.Yb().setStatus()})),u.Nb(),u.Nb(),u.Ob(12,"ion-item",17),u.Ob(13,"ion-label",14),u.sc(14,"Select preset order status"),u.Nb(),u.Ob(15,"ion-select",18),u.Wb("ngModelChange",(function(e){return u.jc(t),u.Yb().orderStatus=e}))("ionChange",(function(){return u.jc(t),u.Yb().setStatus()})),u.Ob(16,"ion-select-option",19),u.sc(17,"Shipment reached"),u.Nb(),u.Ob(18,"ion-select-option",19),u.sc(19,"Shipment delivered"),u.Nb(),u.Ob(20,"ion-select-option",19),u.sc(21,"Shipment cancelled"),u.Nb(),u.Nb(),u.Nb(),u.Ob(22,"ion-item"),u.Ob(23,"ion-label",14),u.sc(24,"Status time"),u.Nb(),u.Ob(25,"ion-datetime",20),u.Wb("ngModelChange",(function(e){return u.jc(t),u.Yb().statusDate=e})),u.Nb(),u.Nb(),u.Nb(),u.Nb(),u.Ob(26,"ion-row"),u.Ob(27,"ion-col",21),u.Ob(28,"ion-buttons"),u.Ob(29,"ion-button",22),u.Wb("click",(function(){return u.jc(t),u.Yb().setNow()})),u.sc(30," Set datetime to now "),u.Nb(),u.Ob(31,"ion-button",23),u.Wb("click",(function(){return u.jc(t),u.Yb().addStatus()})),u.sc(32," Add status "),u.Nb(),u.Nb(),u.Nb(),u.Nb(),u.Nb(),u.Nb()}if(2&t){const t=u.Yb();u.xb(7),u.dc("ngModel",t.statusText),u.xb(4),u.dc("ngModel",t.updateOrder),u.xb(1),u.dc("disabled",!t.updateOrder),u.xb(3),u.dc("ngModel",t.orderStatus),u.xb(1),u.dc("value",3)("disabled",t.shipment.state>=3||-1===t.shipment.state),u.xb(2),u.dc("value",4)("disabled",t.shipment.state>=4||-1===t.shipment.state),u.xb(2),u.dc("value",-1)("disabled",-1===t.shipment.state),u.xb(5),u.dc("ngModel",t.statusDate)}}let N=(()=>{class t{constructor(t,e,n){this.shipping=t,this.modalController=e,this.alertController=n,this.add=!1,this.statusText="",this.updateOrder=!1,this.orderStatus=3}ngOnInit(){this.states=this.shipment.ship_status,this.orderStatus=this.shipment.state+1,-1===this.shipment.state&&(this.orderStatus=-1)}close(){this.modalController.dismiss()}getDate(t){return l.b.toMysqlFormat(new Date(t))}setStatus(){if(this.updateOrder)switch(this.orderStatus){case 3:this.statusText="Shipment reached";break;case 4:this.statusText="Shipment delivered";break;case 5:this.statusText="Shipment cancelled"}}getShipment(){this.shipping.getShipment(this.shipment.ship_id).subscribe(t=>{this.shipment=t,this.states=this.shipment.ship_status})}addStatus(){this.shipping.addStatus({time:l.b.toMysqlFormat(new Date(this.statusDate)),value:this.statusText},this.shipment.ship_id,this.updateOrder,this.shipment.ord_id,this.orderStatus).subscribe(()=>{this.statusDate=void 0,this.statusText="",this.add=!this.add,this.getShipment()},()=>{this.statusDate=void 0,this.statusText="",this.add=!this.add,this.getShipment(),d.a.toast("Could not add status!",3e3,"danger")})}setNow(){this.statusDate=l.b.toMysqlFormat(new Date)}removeStatus(t){return Object(b.a)(this,void 0,void 0,(function*(){const e=yield this.alertController.create({header:"Confirm!",message:"Delete status: "+this.states[t].value,buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary"},{text:"Delete",handler:()=>{this.shipping.removeStatus(t,this.shipment.ship_id).subscribe(()=>{this.getShipment()},()=>{this.getShipment(),d.a.toast("Could not remove status!",3e3,"danger")})}}]});yield e.present()}))}}return t.\u0275fac=function(e){return new(e||t)(u.Jb(h.a),u.Jb(s.I),u.Jb(s.a))},t.\u0275cmp=u.Db({type:t,selectors:[["app-shipping-states"]],inputs:{shipment:"shipment"},decls:9,vars:4,consts:[[4,"ngIf"],["slot","end"],["fill","clear",1,"ion-float-right",3,"click"],["color","danger","slot","icon-only","name","close-circle-outline"],["fill","clear",3,"click"],["name","arrow-back-outline","slot","icon-only","color","dark"],[4,"ngFor","ngForOf"],["fill","outline",1,"ion-float-right","margin",3,"click"],["name","add","slot","end"],["size","10"],["size","2",1,"center-middle"],["fill","outline","color","danger",3,"click"],["name","close","slot","icon-only","color","danger"],["size","10","offset","1"],["position","floating"],["type","text",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange","ionChange"],[3,"disabled"],["interface","popover",3,"ngModel","ngModelChange","ionChange"],[3,"value","disabled"],["display-format","YYYY-MM-DD HH:mm:ss",3,"ngModel","ngModelChange"],["size","12",1,"center-middle"],["fill","outline",1,"ion-float-left",3,"click"],["fill","outline",1,"ion-float-right",3,"click"]],template:function(t,e){1&t&&(u.Ob(0,"ion-header"),u.Ob(1,"ion-toolbar"),u.qc(2,g,2,0,"ion-title",0),u.qc(3,p,4,0,"ion-title",0),u.Ob(4,"ion-buttons",1),u.Ob(5,"ion-button",2),u.Wb("click",(function(){return e.close()})),u.Kb(6,"ion-icon",3),u.Nb(),u.Nb(),u.Nb(),u.Nb(),u.qc(7,f,6,1,"ion-content",0),u.qc(8,O,33,11,"ion-content",0)),2&t&&(u.xb(2),u.dc("ngIf",!e.add),u.xb(1),u.dc("ngIf",e.add),u.xb(4),u.dc("ngIf",!e.add),u.xb(1),u.dc("ngIf",e.add))},directives:[s.k,s.E,i.k,s.d,s.c,s.l,s.C,s.h,s.p,i.j,s.j,s.v,s.g,s.n,s.o,s.m,s.N,o.g,o.i,s.D,s.b,s.x,s.M,s.y,s.i],styles:[""]}),t})();var x=n("lGQG");const w=["table"];function v(t,e){if(1&t){const t=u.Pb();u.Ob(0,"p",23),u.sc(1),u.Kb(2,"br"),u.sc(3),u.Kb(4,"br"),u.sc(5),u.Kb(6,"br"),u.sc(7),u.Kb(8,"br"),u.Ob(9,"ion-button",24),u.Wb("click",(function(){u.jc(t);const n=e.row;return u.Yb().stateControl(n)})),u.sc(10,"View / Add status"),u.Nb(),u.Nb()}if(2&t){const t=e.row,n=u.Yb();u.xb(1),u.uc(" Shipping ID: ",t.ship_id," "),u.xb(2),u.uc(" Order ID: ",t.ord_id," "),u.xb(2),u.uc(" Customer ID: ",t.cust_id," "),u.xb(2),u.uc(" Delivery email: ",t.emp_email," "),u.xb(2),u.dc("disabled",!n.viewStates)}}function C(t,e){if(1&t){const t=u.Pb();u.Ob(0,"a",25),u.Wb("click",(function(){u.jc(t);const n=e.row;return u.Yb().toggleExpandRow(n)})),u.sc(1),u.Nb()}if(2&t){const t=e.row;u.xb(1),u.tc(t.ship_id)}}function S(t,e){if(1&t){const t=u.Pb();u.Ob(0,"a",25),u.Wb("click",(function(){u.jc(t);const n=e.row;return u.Yb().toggleExpandRow(n)})),u.sc(1),u.Nb()}if(2&t){const t=e.row;u.xb(1),u.tc(t.ord_id)}}function M(t,e){if(1&t){const t=u.Pb();u.Ob(0,"a",25),u.Wb("click",(function(){u.jc(t);const n=e.row;return u.Yb().toggleExpandRow(n)})),u.sc(1),u.Nb()}if(2&t){const t=e.row;u.xb(1),u.tc(t.cust_id)}}function D(t,e){if(1&t){const t=u.Pb();u.Ob(0,"a",25),u.Wb("click",(function(){u.jc(t);const n=e.row;return u.Yb().toggleExpandRow(n)})),u.sc(1),u.Nb()}if(2&t){const t=e.row,n=u.Yb();u.xb(1),u.tc(n.getDate(t.ord_date))}}function P(t,e){if(1&t){const t=u.Pb();u.Ob(0,"a",25),u.Wb("click",(function(){u.jc(t);const n=e.row;return u.Yb().toggleExpandRow(n)})),u.sc(1),u.Nb()}if(2&t){const t=e.row,n=u.Yb();u.xb(1),u.tc(n.getDate(t.ship_est_date))}}function k(t,e){if(1&t){const t=u.Pb();u.Ob(0,"a",25),u.Wb("click",(function(){u.jc(t);const n=e.row;return u.Yb().toggleExpandRow(n)})),u.sc(1),u.Nb()}if(2&t){const t=e.row,n=u.Yb();u.xb(1),u.tc(n.getPhone(t.emp_phone))}}const y=[{path:"",component:(()=>{class t{constructor(t,e,n,i){this.shippingService=t,this.auth=e,this.modalController=n,this.cdr=i,this.columnMode=c.a.force,this.shipments=[],this.pageNumber=0,this.numPerPage=25,this.loading=!1,this.total=0,this.role=r.a.Empty,this.search="",this.viewStates=!1,this.setPage({offset:0}),this.role=this.auth.getRole(),this.viewStates=-1===[0,3,5,7].indexOf(this.role)}ngOnInit(){}reset(){this.pageNumber=0,this.numPerPage=25,this.loading=!1,this.total=0,this.search="",this.startDate=void 0,this.endDate=void 0,this.viewStates=!1,this.setPage({offset:0})}setPage(t){this.pageNumber=t.offset,this.loading=!0,this.shippingService.getShipments(this.pageNumber,this.numPerPage,this.search,this.startDate,this.endDate).subscribe(t=>{this.shipments=t.data,this.shipments=[...this.shipments],this.total=t.total,this.loading=!1,this.cdr.detectChanges()})}toggleExpandRow(t){this.table.rowDetail.toggleExpandRow(t),this.cdr.detectChanges()}getDate(t){return l.b.toMysqlFormat(new Date(t))}getPhone(t){const e=t.slice(-10);return`+${t.slice(0,t.length-10)} ${e.slice(0,3)}-${e.slice(3,6)}-${e.slice(6)}`}stateControl(t){return Object(b.a)(this,void 0,void 0,(function*(){const e=yield this.modalController.create({component:N,cssClass:"view-order",componentProps:{shipment:t}});yield e.present(),yield e.onWillDismiss(),this.setPage({offset:0})}))}}return t.\u0275fac=function(e){return new(e||t)(u.Jb(h.a),u.Jb(x.a),u.Jb(s.I),u.Jb(u.h))},t.\u0275cmp=u.Db({type:t,selectors:[["app-shipping"]],viewQuery:function(t,e){var n;1&t&&u.wc(w,!0),2&t&&u.gc(n=u.Xb())&&(e.table=n.first)},decls:53,vars:34,consts:[["slot","end"],["fill","clear",3,"click"],["name","close","slot","icon-only","color","danger"],["name","refresh","slot","icon-only"],["size","5"],["position","floating"],["type","text","debounce","500",3,"ngModel","ngModelChange","ionChange"],["size","3"],["display-format","DD-MM-YYYY",3,"ngModel","ionChange","ngModelChange"],["size","1"],["interface","popover",3,"ngModel","value","ngModelChange","ionChange"],[3,"value"],[1,"material","expandable","margin",3,"rowHeight","rows","headerHeight","footerHeight","columnMode","trackByProp","count","externalPaging","offset","limit","externalSorting","loadingIndicator","scrollbarH","reorderable","page"],["table",""],["rowHeight","auto"],["ngx-datatable-row-detail-template",""],["prop","ship_id","name","Shipping ID",3,"resizeable","sortable"],["ngx-datatable-cell-template",""],["prop","ord_id","name","Order ID",3,"resizeable","sortable"],["prop","cust_id","name","Customer ID",3,"resizeable","sortable"],["prop","ord_date","name","Order Date",3,"resizeable","sortable"],["prop","ship_est_date","name","Estimated Date",3,"resizeable","sortable"],["prop","emp_phone","name","Delivery phone",3,"resizeable","sortable"],[2,"user-select","text","-webkit-user-select","text","margin","0.5em","width","100%"],["fill","outline",3,"disabled","click"],[1,"table-link",3,"click"]],template:function(t,e){1&t&&(u.Ob(0,"ion-header"),u.Ob(1,"ion-toolbar"),u.Ob(2,"ion-title"),u.sc(3,"Shipments"),u.Nb(),u.Ob(4,"ion-buttons",0),u.Ob(5,"ion-button",1),u.Wb("click",(function(){return e.reset()})),u.Kb(6,"ion-icon",2),u.Nb(),u.Ob(7,"ion-button",1),u.Wb("click",(function(){return e.setPage({offset:0})})),u.Kb(8,"ion-icon",3),u.Nb(),u.Nb(),u.Nb(),u.Nb(),u.Ob(9,"ion-content"),u.Ob(10,"ion-grid"),u.Ob(11,"ion-row"),u.Ob(12,"ion-col",4),u.Ob(13,"ion-item"),u.Ob(14,"ion-label",5),u.sc(15,"Search"),u.Nb(),u.Ob(16,"ion-input",6),u.Wb("ngModelChange",(function(t){return e.search=t}))("ionChange",(function(){return e.setPage({offset:0})})),u.Nb(),u.Nb(),u.Nb(),u.Ob(17,"ion-col",7),u.Ob(18,"ion-item"),u.Ob(19,"ion-label",5),u.sc(20,"Start date"),u.Nb(),u.Ob(21,"ion-datetime",8),u.Wb("ionChange",(function(){return e.setPage({offset:0})}))("ngModelChange",(function(t){return e.startDate=t})),u.Nb(),u.Nb(),u.Nb(),u.Ob(22,"ion-col",7),u.Ob(23,"ion-item"),u.Ob(24,"ion-label",5),u.sc(25,"End date"),u.Nb(),u.Ob(26,"ion-datetime",8),u.Wb("ionChange",(function(){return e.setPage({offset:0})}))("ngModelChange",(function(t){return e.endDate=t})),u.Nb(),u.Nb(),u.Nb(),u.Ob(27,"ion-col",9),u.Ob(28,"ion-item"),u.Kb(29,"ion-label",5),u.Ob(30,"ion-select",10),u.Wb("ngModelChange",(function(t){return e.numPerPage=t}))("ionChange",(function(){return e.setPage({offset:0})})),u.Ob(31,"ion-select-option",11),u.sc(32,"25"),u.Nb(),u.Ob(33,"ion-select-option",11),u.sc(34,"50"),u.Nb(),u.Ob(35,"ion-select-option",11),u.sc(36,"100"),u.Nb(),u.Nb(),u.Nb(),u.Nb(),u.Nb(),u.Nb(),u.Ob(37,"ngx-datatable",12,13),u.Wb("page",(function(t){return e.setPage(t)})),u.Ob(39,"ngx-datatable-row-detail",14),u.qc(40,v,11,5,"ng-template",15),u.Nb(),u.Ob(41,"ngx-datatable-column",16),u.qc(42,C,2,1,"ng-template",17),u.Nb(),u.Ob(43,"ngx-datatable-column",18),u.qc(44,S,2,1,"ng-template",17),u.Nb(),u.Ob(45,"ngx-datatable-column",19),u.qc(46,M,2,1,"ng-template",17),u.Nb(),u.Ob(47,"ngx-datatable-column",20),u.qc(48,D,2,1,"ng-template",17),u.Nb(),u.Ob(49,"ngx-datatable-column",21),u.qc(50,P,2,1,"ng-template",17),u.Nb(),u.Ob(51,"ngx-datatable-column",22),u.qc(52,k,2,1,"ng-template",17),u.Nb(),u.Nb(),u.Nb()),2&t&&(u.xb(16),u.dc("ngModel",e.search),u.xb(5),u.dc("ngModel",e.startDate),u.xb(5),u.dc("ngModel",e.endDate),u.xb(4),u.dc("ngModel",e.numPerPage)("value",25),u.xb(1),u.dc("value",25),u.xb(2),u.dc("value",50),u.xb(2),u.dc("value",100),u.xb(2),u.dc("rowHeight",50)("rows",e.shipments)("headerHeight",50)("footerHeight",50)("columnMode",e.columnMode)("trackByProp","updated")("count",e.total)("externalPaging",!0)("offset",e.pageNumber)("limit",e.numPerPage)("externalSorting",!0)("loadingIndicator",e.loading)("scrollbarH",!0)("reorderable",!0),u.xb(4),u.dc("resizeable",!0)("sortable",!0),u.xb(2),u.dc("resizeable",!0)("sortable",!0),u.xb(2),u.dc("resizeable",!0)("sortable",!0),u.xb(2),u.dc("resizeable",!0)("sortable",!0),u.xb(2),u.dc("resizeable",!0)("sortable",!0),u.xb(2),u.dc("resizeable",!0)("sortable",!0))},directives:[s.k,s.E,s.C,s.d,s.c,s.l,s.h,s.j,s.v,s.g,s.n,s.o,s.m,s.N,o.g,o.i,s.i,s.M,s.x,s.y,c.d,c.e,c.f,c.c,c.b],styles:["[_nghost-%COMP%]     ngx-datatable .datatable-scroll, [_nghost-%COMP%]     ngx-datatable .datatable-scroller{width:100%!important}"]}),t})()}];let Y=(()=>{class t{}return t.\u0275mod=u.Hb({type:t}),t.\u0275inj=u.Gb({factory:function(e){return new(e||t)},imports:[[a.j.forChild(y)],a.j]}),t})(),j=(()=>{class t{}return t.\u0275mod=u.Hb({type:t}),t.\u0275inj=u.Gb({factory:function(e){return new(e||t)},imports:[[i.c,o.d,s.F,Y,c.g]]}),t})()}}]);